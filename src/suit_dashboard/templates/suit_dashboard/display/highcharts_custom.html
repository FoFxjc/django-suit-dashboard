<div class="box-widget {{ widget.classes }}">
  {% if widget.get_name %}<h2 class="box-widget-name">{{ widget.get_name }}</h2>{% endif %}
  <div class="box-widget-content" id="{{ widget.name }}"></div>
  {% with chart_url='admin:'|add:widget.url_name %}
    <script>
      var dataset = {{ widget.get_content|safe }};
      {% for js_code in widget.get_content.js_code %}
        try {
          if (dataset.{{ js_code }}) {
            dataset.{{ js_code }} = new Function(dataset.{{ js_code }});
          }
        } catch (err) {
          console.log(err);
        }
      {% endfor %}

      var chart = $('#{{ widget.name }}').highcharts(dataset);

      $(function () {
        setInterval(function() {
          $.getJSON("{% url chart_url %}", function(refreshed_data) {
            chart.series[0].addPoint(refreshed_data, true, true);
            chart.redraw();
          });
        }, {{ widget.refresh_time }});
      });
    </script>
  {% endwith %}
</div>
